"use strict";var Panopto=Panopto||{};Panopto.UI=Panopto.UI||{},Panopto.UI.ShareControl=function(e,o,t){var n,a,r,s,l,i,c,d=void 0===t?{}:t,p=d.isFolder,u=void 0!==p&&p,h=d.sendShareEmailsByDefault,f=void 0===h?Panopto.features.sendShareEmailsByDefault:h,v=d.displayIncludeEventsCheckbox,P=void 0===v?Panopto.features.displayIncludeEventsCheckbox:v,g=d.includeEventsCheckboxDefault,m=void 0===g?Panopto.features.includeEventsCheckboxDefault:g,S=d.includeEventsCheckboxSupported,b=void 0!==S&&S,y=d.toggleSubmit,R=void 0===y?function(){return!1}:y,C=d.onToggleNoteError,I=void 0===C?$.noop:C,T=d.roles,A=void 0===T?[]:T,k=d.canShare,D=void 0===k||k,G=Panopto.Core.UI.Components.restSpinner((function(e){$("."+N).toggleClass("spinning",e)})),x=1200,M="share-add-input",N="share-spinner",E="share-note-input",U="shareNotify",F="<div class='share-add'><ul class='share-add-input'><div class='"+N+"'></div></ul><select class='"+"share-add-role' style='display:none;' tabindex='0'><@ _.each(roles, function (role) { @><option value='<@= role.value @>'><@= role.name @></option><@ }); @></select></div><div class='"+"share-note' style='display:none;'><div class='"+"share-notify'><input type='checkbox' id='"+U+"' class='share-notify-checkbox' tabindex='0' /><label for='"+U+"'>"+Panopto.GlobalResources.ShareControl_Notify+"</label></div><textarea class='"+E+"' tabindex='0'></textarea><div class='"+"share-include-events' style='display:none;'><input type='checkbox' id='"+"shareIncludeEvents' class='share-include-events-checkbox' tabindex='0' /><label for='"+"shareIncludeEvents'>"+Panopto.GlobalResources.ShareControl_IncludeEvents+"</label></div></div><div id='"+"invitationWarning' style='display:none;'>"+Panopto.GlobalResources.Share_Default_Note+"&nbsp;<a target='_blank' href='<@= helpUrl @>'>"+Panopto.GlobalResources.Share_MoreInfo+"</a></div><div class='share-confirm'></div>",q=!!(1===o.length&&o[0].typeName===Panopto.Core.ServiceInterface.Rest.Objects.TypeName.Session&&o[0].isFinishedRecording&&P&&b),w=function(){return n.getModels().length>0},O=function(){var e=R();I(e&&!j(),String.format(Panopto.GlobalResources.Share_NotificationError,x))},j=function(){return s.val().length<x||!l.prop("checked")};e.html(_.template(F)({roles:_.map(A,(function(e){return{value:e.Id,name:e.SystemDefault?Panopto.GlobalResources[PanoptoTS.StringHelpers.format("Share_Permission_{0}",AutoRestModels.SystemDefaultRole[e.SystemDefault])]:e.Name}})),helpUrl:Panopto.useFreeTrialTerminology?PanoptoCore.Constants.ProHowToShareLink:Panopto.Core.StringHelpers.getHelpUrl(Panopto.version,Panopto.Core.MajorSupportArea.Settings,Panopto.Core.MinorSupportArea.Sharing)})),a=e.find("."+M),D&&(n=Panopto.Core.UI.Components.tagSearch(a,(function(e,t,n){var a={searchTerm:e,noAccessToItemId:void 0,noAccessToItemType:void 0};u?a.noAccessToItemType="Folder":(a.noAccessToItemId=o[0].id,a.noAccessToItemType=o[0].typeName),Panopto.Core.ServiceInterface.Rest.Access.readReceiverSuggestions(a,Panopto.Core.Constants.MaxSuggestionResults,(function(e){var o=_.map(e,(function(e){return{value:e.name,tagId:e.key||e.id,model:e}}));t(o)}),n,G.showUntilComplete())}),{initialPlaceholder:u?Panopto.useFreeTrialTerminology?Panopto.GlobalResources.ShareControl_Folder_AddPlaceholder_Trial:Panopto.GlobalResources.ShareControl_Folder_AddPlaceholder:Panopto.useFreeTrialTerminology?Panopto.GlobalResources.ShareControl_AddPlaceholder_Trial:Panopto.GlobalResources.ShareControl_AddPlaceholder,suggestedUser:Panopto.GlobalResources.Groups_Membership_Suggestion,inviteRequest:Panopto.GlobalResources.ShareControl_InviteRequest,providerSuggestionText:Panopto.GlobalResources.TagSearch_ProviderSuggestion},{onChange:function(){var o=n.getModels(),t=(w(),e.find(".share-note")),a=$("#invitationWarning"),r=_.some(o,(function(e){return e.isInviteRequest&&e.isInviteRequest()})),c=r||_.some(o,(function(e){return e.email||e.typeName===Panopto.Core.ServiceInterface.Rest.Objects.TypeName.Group})),d=r||c&&!t.is(":visible")&&f;t.toggle(c),d?l.prop("checked",!0):c||l.prop("checked",!1),s.toggle(l.prop("checked")),i.toggle(q&&l.prop("checked")),l.prop("disabled",r),a.toggle(r),O()},suggestProviders:!Panopto.useFreeTrialTerminology})),r=e.find(".share-add-role"),A.length>1?r.show():e.find(".share-notify").addClass("no-role-selector"),i=e.find(".share-include-events"),c=e.find("#shareIncludeEvents"),l=e.find("#"+U),s=e.find("."+E),l.change((function(){s.toggle(this.checked),i.toggle(q&&this.checked),O()})),Panopto.Core.UI.Accessibility.checkbox(l),s.on("change keyup",(function(){I(!j(),String.format(Panopto.GlobalResources.Share_NotificationError,x))})),s.attr("placeholder",Panopto.useFreeTrialTerminology&&!u?Panopto.GlobalResources.ShareControl_NotePlaceholder_Trial.format(Panopto.user.fullNameOrKey):Panopto.GlobalResources.ShareControl_NotePlaceholder),c.prop("checked",m&&q);var H=Panopto.Core.Browser.isCssSupported("animation");return Panopto.Core.UI.Components.spinner($(".share-spinner"),H),{save:function(e,t){var a,i,d=[],p=r.val();switch(null==(a=p?_.find(A,(function(e){return e.Id===p})):A[0])?void 0:a.SystemDefault){case AutoRestModels.SystemDefaultRole.Creator:i=Panopto.Data.AclRoleType.Creator;break;case AutoRestModels.SystemDefaultRole.Viewer:i=Panopto.Data.AclRoleType.Viewer;break;case AutoRestModels.SystemDefaultRole.Publisher:i=Panopto.Data.AclRoleType.Publisher;break;default:i=Panopto.Data.AclRoleType.Custom}_.each(o,(function(e){_.each(n.getModels(),(function(o){d.push(Panopto.Core.ServiceInterface.Rest.Objects.Access({item:e,receiver:o,role:o.isInviteRequest&&o.isInviteRequest()?Panopto.Data.AclRoleType.DirectViewerOnly:i,roleId:p}))}))})),d.length?Panopto.Core.ServiceInterface.Rest.Access.batchCreate(d,l.prop("checked"),s.val().trim(),c.prop("checked")&&q,(function(r){a.SystemDefault===AutoRestModels.SystemDefaultRole.Publisher&&_.some(o,(function(e){return!e.isApprovalRequired}))&&confirm(1===o.length?Panopto.GlobalResources.ShareControl_RequireApprovalPrompt_Single:Panopto.GlobalResources.ShareControl_RequireApprovalPrompt_Multiple)&&(_.each(o,(function(e){e.isApprovalRequired=!0})),Panopto.Core.ServiceInterface.Rest.FolderAccessItems.saveMany(o)),n.clear(),r.failed.length?t(!!r.succeeded.length,r.failed):e()}),(function(){t(!1)})):e()},cancel:function(){n.clear()},hasChanges:w,isPending:function(){return n.hasPendingTags()},passesValidation:j,shouldSend:function(){return l.prop("checked")&&w()},addMeetingParticipants:function(e){_.each(e,(function(e){return n.addManualTag(e)}))}}};
//# sourceMappingURL=file://///seasyn/jenkinsbuilds/rel_rtc_11.10.0/11.10.0.00017/_PublishedWebsites/WebUI/Scripts/Panopto/Pages/Share/ShareControl.js.map
